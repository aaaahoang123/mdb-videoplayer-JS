function getVideoFromYoutube(e){!0===e&&(pageToken="");var t="https://content.googleapis.com/youtube/v3/search?q="+searchQuery+"&videoEmbeddable=true&maxResults=12&type=video&videoSyndicated=true&part=snippet&pageToken="+pageToken+"&key=AIzaSyBStdhzhkK8ne1tqsUz4A8j9axNi0NqE_M",a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=(a=JSON.parse(this.responseText)).items;pageToken=a.nextPageToken;for(var t=0;t<e.length;t++)new videoData(e[t].id.videoId,e[t].snippet.title,e[t].snippet.description,"","",e[t].snippet.thumbnails.medium.url).display();toastr.info("Đã load xong video!")}else if(4===this.readyState&&200!==this.status){var a=JSON.parse(this.responseText);console.log(a)}},a.open("GET",t,!0),a.send()}function searchVideo(){searchQuery=document.querySelector("#search-query").value,document.getElementById("youtubeVideoView").innerHTML="",getVideoFromYoutube(!0)}function enterToSearch(e){13!==e.which&&13!==e.keyCode||searchVideo()}function playVideo(e){return document.querySelector("#modalYT").classList.remove("fadeOut"),document.querySelector("#modalYT").classList.add("fadeIn"),document.querySelector("#modalYT div div div div iframe").src="https://www.youtube.com/embed/"+e.youtubeId,document.querySelector("#watch-video-detail").href="pages/watch.html?yid="+e.youtubeId,videoDataToSend.data.attributes=e,setTimeout(function(){$("#modalYT").modal("show")},100),!0}function closeVideoModal(){document.querySelector("#modalYT").classList.remove("fadeIn"),document.querySelector("#modalYT").classList.add("fadeOut"),setTimeout(function(){$("#modalYT").modal("hide"),document.querySelector("#modalYT div div div div iframe").src=""},100)}function loadUserPlaylist(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){var e=JSON.parse(this.response).data,t=document.querySelector("#sticky-playlist-card"),a=document.querySelector("section#modalYT > div > div > div > div.dropdown > div.dropdown-menu");if(void 0!==e){for(var d=0;d<e.length&&d<3;d++){playlistId=e[d].id;var i=document.createElement("div");i.className="row z-depth-1 padding-thumb",i.addEventListener("dragover",function(){allowDrop(event)}),i.setAttribute("ondrop","drop(event,"+playlistId+")");var o=document.createElement("a");o.href="pages/watch.html?plid="+playlistId,o.className="col-md-4 col-sm-6 responsive-background",o.style.backgroundImage="url("+e[d].attributes.thumbnailUrl+")";var n=document.createElement("div");n.className="col-md-8 col-sm-6",n.style.paddingTop="5px";var s=document.createElement("a");s.className="grey-text",s.href="pages/watch.html?plid="+playlistId;var r=document.createElement("h5");r.appendChild(document.createTextNode(e[d].attributes.name)),s.appendChild(r);var l=document.createElement("p");l.appendChild(document.createTextNode(e[d].attributes.description)),n.appendChild(s),n.appendChild(l),i.appendChild(o),i.appendChild(n),t.appendChild(i)}for(d=0;d<e.length;d++){playlistId=e[d].id;var c=document.createElement("a");c.className="dropdown-item",c.appendChild(document.createTextNode(e[d].attributes.name)),c.setAttribute("onclick","addVideoToPlaylist("+playlistId+")"),a.appendChild(c)}}}else 4===this.readyState&&200!==this.status&&console.log(this.response)},e.open("GET",playlistApi),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization",localStorage.getItem("token")),e.send()}function addVideoToPlaylist(e){videoDataToSend.quickUploadVideo(e)}function loadTopTrendingVideo(){xhttp=new XMLHttpRequest,xhttp.onreadystatechange=function(){if(4===this.readyState)if(200===this.status)for(var e=JSON.parse(this.responseText),t=e.items,a=document.querySelector("#carousel-top-trend div").querySelectorAll("div.carousel-item a div img"),d=document.querySelector("#carousel-top-trend div").querySelectorAll("div.carousel-item a div h4"),i=document.querySelector("#carousel-top-trend div").querySelectorAll("div.carousel-item a"),o=0;o<t.length;o++)a[o].src="https://i.ytimg.com/vi/"+t[o].id+"/hqdefault.jpg",d[o].innerHTML=t[o].snippet.title,i[o].href="pages/watch.html?yid="+t[o].id;else e=JSON.parse(this.responseText),console.log(e)},xhttp.open("GET","https://www.googleapis.com/youtube/v3/videos?part=snippet&chart=mostPopular&maxResults=3&regionCode=VN&key=AIzaSyBStdhzhkK8ne1tqsUz4A8j9axNi0NqE_M",!0),xhttp.send()}function getNewAddVideo(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var e=JSON.parse(this.responseText);void 0!==e.data?(document.querySelector("#new-video-card > div > div > a").href="pages/watch.html?plid="+e.data[0].attributes.playlistId+"&cid="+e.data[0].id,document.querySelector("#new-video-card > div > div > a > div > img").src="https://i.ytimg.com/vi/"+e.data[0].attributes.youtubeId+"/mqdefault.jpg",document.querySelector("#new-video-card > div > div > a > div > img").alt=e.data[0].attributes.name,document.querySelector("#new-video-card > div > div > a > div > p").innerHTML=e.data[0].attributes.name):(document.querySelector("#new-video-card > div > div > a > div > img").src="http://1.bp.blogspot.com/-SRdKauDRBg4/T3pVgdOxgAI/AAAAAAAAAZs/-QxJ9qdb8FI/s640/undefined_01.jpg",document.querySelector("#new-video-card > div > div > a > div > img").alt="Chưa có video",document.querySelector("#new-video-card > div > div > a > div > p").innerHTML="Không có video mới! Bạn chưa đăng nhập hoặc chưa từng upload video")}else e=JSON.parse(this.responseText),console.log(e)},e.open("GET",videoApi+"?page=1&limit=1",!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization",localStorage.getItem("token")),e.send()}function dragVideo(e,t){e.dataTransfer.setData("text/plain",JSON.stringify(t))}function allowDrop(e){e.preventDefault()}function drop(e,t){e.preventDefault();var a=e.dataTransfer.getData("text");videoDataToSend.data.attributes=JSON.parse(a),videoDataToSend.quickUploadVideo(t)}var pageToken="",searchQuery="",videoDataToSend=new videoData;videoData.prototype.display=function(){var e=this.data.attributes,t=document.createElement("div");t.className="col-lg-4 col-md-6 col-sm-6",t.style.overflow="hidden",t.style.textOverflow="ellipsis";var a=document.createElement("div");a.className="card";var d=document.createElement("div");d.className="view overlay waves-effect waves-light z-depth-1";var i=document.createElement("img");i.className="img-fluid",i.src=this.data.attributes.thumbnail,i.style.width="100%",i.alt=this.data.attributes.name;var o=document.createElement("a");o.addEventListener("click",function(){playVideo(e)}),o.addEventListener("dragstart",function(){dragVideo(event,e)}),o.setAttribute("draggable","true");var n=document.createElement("div");n.className="mask flex-center";var s=document.createElement("i");s.className="fa fa-play-circle-o fa-3x white-text",n.appendChild(s),o.appendChild(n),d.appendChild(i),d.appendChild(o),a.appendChild(d);var r=document.createElement("a");r.className="grey-text",r.addEventListener("click",function(){playVideo(e)});var l=document.createElement("h6");l.appendChild(document.createTextNode(this.data.attributes.name)),r.appendChild(l),t.appendChild(a),t.appendChild(r),document.getElementById("youtubeVideoView").appendChild(t)},videoData.prototype.quickUploadVideo=function(e){this.data.attributes.playlistId=e;var t=new XMLHttpRequest;t.onreadystatechange=function(){4===this.readyState&&(201===this.status?(resp=JSON.parse(this.responseText),toastr.success("Thêm video vào playlist thành công!")):console.log(this.responseText))},t.open("POST",videoApi,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send(JSON.stringify(this))};