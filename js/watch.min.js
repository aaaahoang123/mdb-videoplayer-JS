function loadSuggestVideo(e){var t="https://content.googleapis.com/youtube/v3/search?q="+e+"&videoEmbeddable=true&maxResults=10&type=video&videoSyndicated=true&part=snippet&key=AIzaSyBStdhzhkK8ne1tqsUz4A8j9axNi0NqE_M",a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){for(var e=JSON.parse(this.responseText).items,t=0;t<e.length;t++){var a=new videoData(e[t].id.videoId,e[t].snippet.title,e[t].snippet.description,"","",e[t].snippet.thumbnails.medium.url);a.addIdCrTime("",e[t].snippet.publishedAt),a.bindToSide()}$(".hover-popover").popover({trigger:"hover"})}else respone=JSON.parse(this.responseText),console.log(respone),toastr.warning("Đã xảy ra lỗi! Có thể không tìm thấy video nào liên quan!")},a.open("GET",t,!0),a.send()}function loadVideoOfPlaylist(e,t){var a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var a=JSON.parse(this.responseText).data;if(void 0!==a){for(var i=0,o=0;o<a.length;o++)a[o].id===t&&(i=o);var d=new videoData(a[i].attributes.youtubeId,a[i].attributes.name,a[i].attributes.description,a[i].attributes.keywords,e,a[i].attributes.thumbnail);for(console.log(d),d.bindToForm(),document.querySelector("#videoFormModal > div > div > div.modal-footer > button").addEventListener("click",function(){editVideo(d.id)}),document.querySelector("#alert-delete-video > div > div > div.modal-footer").querySelectorAll("a")[0].addEventListener("click",function(){deleteVideo(d.id)}),d.addIdCrTime(a[i].id,a[i].attributes.createdTimeMLS),loadSuggestVideo(d.data.attributes.name),d.watchVideo(),a.splice(i,1),o=0;o<a.length/6;o++){var r=document.createElement("li");r.className="nav-item";var n=document.createElement("a");n.setAttribute("data-toggle","tab"),n.setAttribute("role","tab");var s=document.createElement("div");0===o?(s.className="tab-pane fade in show active",s.id="same-pl-tab-1",n.className="nav-link orange-text waves-light active"):(s.className="tab-pane fade",s.id="same-pl-tab-"+(o+1),n.className="nav-link orange-text waves-light");var l=document.createElement("div");for(l.className="row",n.href="#"+s.id,n.innerHTML=o+1,r.appendChild(n),i=6*o;i<6*o+6&&i<a.length;i++){var c=new videoData(a[i].attributes.youtubeId,a[i].attributes.name,"","",a[i].attributes.playlistId,a[i].attributes.thumbnail);c.addIdCrTime(a[i].id,""),c.bindToTab(l,a[i].attributes.playlistId),s.appendChild(l)}document.querySelector("#same-playlist-modal > div > div > div.modal-body > div.tab-content").appendChild(s),document.querySelector("#same-playlist-modal > div > div > div.modal-body > section.tabs-wrapper > ul").appendChild(r)}}document.getElementById("content").style.display=""}else a=JSON.parse(this.responseText),console.log(a)},a.open("GET",videoApi+"?playlist="+e+"&page=1&limit=100",!0),a.setRequestHeader("Content-Type","application/json"),a.setRequestHeader("Authorization",localStorage.getItem("token")),a.send()}function loadVideoOfYoutube(e){var t="https://www.googleapis.com/youtube/v3/videos?part=snippet&id="+e+"&key=AIzaSyBStdhzhkK8ne1tqsUz4A8j9axNi0NqE_M",a=new XMLHttpRequest;a.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var e=JSON.parse(this.responseText).items[0];if(void 0!==e){var t=new videoData(e.id,e.snippet.title,e.snippet.description,e.snippet.tags,"",e.snippet.thumbnails.medium.url);t.bindToForm(),document.querySelector("#videoFormModal > div > div > div.modal-footer > button").addEventListener("click",uploadVideo),t.addIdCrTime("",e.snippet.publishedAt),t.watchVideo(),loadSuggestVideo(e.snippet.title),document.getElementById("content").style.display=""}else $("#alertModal").modal()}else e=JSON.parse(this.responseText),console.log(e)},a.open("GET",t,!0),a.send()}function loadPlaylistDetail(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){for(var t=JSON.parse(this.responseText).data,a=0;a<t.length;a++){var i=document.createElement("option");i.value=t[a].id,i.innerHTML=t[a].attributes.name,t[a].id===e&&(i.setAttribute("selected","true"),document.querySelector("#watching-playlist > div.view > div.playlist-thumb").style.backgroundImage="url("+t[a].attributes.thumbnailUrl+")",document.querySelector("#watching-playlist").addEventListener("dragover",function(e){allowDrop(e)}),document.querySelector("#watching-playlist").addEventListener("drop",function(t){drop(t,e)}),document.querySelector("#watching-playlist > div.card-body > h4").innerHTML=t[a].attributes.name,document.querySelector("#watching-playlist > div.card-body > p").innerHTML=t[a].attributes.description,document.querySelector("#watching-playlist > div.card-data > ul > li > span").innerHTML=new Date(t[a].attributes.createdTimeMLS).toLocaleDateString()),document.forms.uploadOrEditForm.playlistId.appendChild(i)}$(".material").materialForm()}else t=JSON.parse(this.responseText),console.log(t)},t.open("GET",playlistApi,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send()}function uploadVideo(){var e=document.forms.uploadOrEditForm.videoId.value,t=document.forms.uploadOrEditForm.videoName.value,a=document.forms.uploadOrEditForm.description.value,i=document.forms.uploadOrEditForm.keywords.value,o=document.forms.uploadOrEditForm.playlistId.value,d="https://i.ytimg.com/vi/"+e+"/mqdefault.jpg";new videoData(e,t,a,i,o,d).uploadVideo()}function editVideo(e){var t=document.forms.uploadOrEditForm.videoId.value,a=document.forms.uploadOrEditForm.videoName.value,i=document.forms.uploadOrEditForm.description.value,o=document.forms.uploadOrEditForm.keywords.value,d=document.forms.uploadOrEditForm.playlistId.value,r="https://i.ytimg.com/vi/"+t+"/mqdefault.jpg";new videoData(t,a,i,o,d,r).editVideo(e)}function deleteVideo(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(200===this.status){var e=JSON.parse(this.responseText);toastr.error("Xóa video thành công"),$("#videoFormModal").modal("hide"),$("#alert-delete-video").modal("hide"),setTimeout(function(){location.href="../index.html"},1e3),console.log(e)}else e=JSON.parse(this.responseText),console.log(e)},t.open("DELETE",videoApi+"/"+e,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send()}function dragVideo(e,t){e.dataTransfer.setData("text/plain",JSON.stringify(t))}function allowDrop(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()}function drop(e,t){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation();var a=JSON.parse(e.dataTransfer.getData("text"));a.data.attributes.playlistId=t;var i=new videoData;i.data=a.data,i.uploadVideo()}if($(document).ready(function(){$(".hover-popover").popover({trigger:"hover"})}),videoData.prototype.addIdCrTime=function(e,t){this.id=e,this.createdTime=t},videoData.prototype.watchVideo=function(){document.querySelector("#watching-video > div.card > div > iframe").src="https://www.youtube.com/embed/"+this.data.attributes.youtubeId+"?autoplay=1",document.querySelector("#watching-video > div.card > div.card-body > div.row > h4.col-md-9").innerHTML=this.data.attributes.name;var e=new Date(this.createdTime).toLocaleDateString();document.querySelector("#watching-video > div.card > div.card-body").querySelectorAll("p span")[0].innerHTML=e,document.querySelector("#watching-video > div.card > div.card-body").querySelectorAll("p span")[1].innerHTML=this.data.attributes.description;var t=JSON.stringify(this.data.attributes.keywords);void 0!==t&&(t=(t=t.replace("[","")).replace("]","")),document.getElementById("video-keyword").innerHTML=t},videoData.prototype.bindToSide=function(){var e=new videoData;e.data=this.data;var t=document.createElement("div");t.className="row padding-thumb";var a=document.createElement("div");a.className="col-md-6";var i=document.createElement("a");i.href="watch.html?yid="+this.data.attributes.youtubeId,i.setAttribute("draggable","true"),i.addEventListener("dragstart",function(t){dragVideo(t,e)});var o=document.createElement("img");o.src=this.data.attributes.thumbnail,o.alt=this.data.attributes.name,o.title=this.data.attributes.name,o.style.width="100%",i.appendChild(o),a.appendChild(i),t.appendChild(a);var d=document.createElement("div");d.className="col-md-6";var r=document.createElement("div");r.className="ellipsis";var n=document.createElement("a");n.style.marginBottom="5px",n.className="hover-popover black-text",n.href="watch.html?yid="+this.data.attributes.youtubeId,n.setAttribute("data-toggle","popover"),n.setAttribute("data-placement","top"),n.setAttribute("data-content",this.data.attributes.name),n.setAttribute("data-original-title",""),n.setAttribute("title",""),n.appendChild(document.createTextNode(this.data.attributes.name)),r.appendChild(n);var s=document.createElement("p");s.className="grey-text watch-side-title";var l=new Date(this.createdTime).toLocaleDateString();s.innerHTML="<strong>Xuất bản:</strong> <span>"+l+"</span>",d.appendChild(r),d.appendChild(s),t.appendChild(d),document.getElementById("sub-video").appendChild(t)},videoData.prototype.bindToTab=function(e,t){var a=document.createElement("div");a.className="col-lg-2 col-md-4 col-sm-6",a.style.overflow="hidden",a.style.textOverflow="ellipsis";var i=document.createElement("div");i.className="card";var o=document.createElement("div");o.className="view overlay waves-effect waves-light";var d=document.createElement("img");d.className="img-fluid",d.src=this.data.attributes.thumbnail,d.alt=this.data.attributes.name,d.title=this.data.attributes.name,d.style.width="100%";var r=document.createElement("a");r.href="watch.html?plid="+t+"&cid="+this.id;var n=document.createElement("div");n.className="mask flex-center",n.innerHTML='<i class="fa fa-play-circle-o fa-3x white-text"></i>',r.appendChild(n),o.appendChild(d),o.appendChild(r),i.appendChild(o),a.appendChild(i);var s=document.createElement("a");s.href="watch.html?plid="+t+"&cid="+this.id,s.className="grey-text";var l=document.createElement("h6");l.style.marginTop="5px",l.appendChild(document.createTextNode(this.data.attributes.name)),s.appendChild(l),a.appendChild(s),e.appendChild(a)},videoData.prototype.bindToForm=function(){document.forms.uploadOrEditForm.videoId.value=this.data.attributes.youtubeId,document.forms.uploadOrEditForm.videoName.value=this.data.attributes.name,document.forms.uploadOrEditForm.description.value=this.data.attributes.description,document.forms.uploadOrEditForm.keywords.value=this.data.attributes.keywords,document.forms.uploadOrEditForm.playlistId.value=this.data.attributes.playlistId;for(var e=document.querySelectorAll("#uploadOrEditForm label"),t=0;t<e.length;t++)e[t].className="active"},videoData.prototype.uploadVideo=function(){var e=new XMLHttpRequest;e.onreadystatechange=function(){if(4===this.readyState)if(201===this.status){var e=JSON.parse(this.responseText);toastr.success("Đã thêm video thành công!"),$("#videoFormModal").modal("hide"),console.log(e)}else e=JSON.parse(this.responseText),console.log(e)},e.open("POST",videoApi,!0),e.setRequestHeader("Content-Type","application/json"),e.setRequestHeader("Authorization",localStorage.getItem("token")),e.send(JSON.stringify(this))},videoData.prototype.editVideo=function(e){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(4===this.readyState)if(201===this.status){var e=JSON.parse(this.responseText);toastr.success("Chỉnh sửa video thành công! Mời xem lại tại mục quản lý playlist"),$("#videoFormModal").modal("hide"),console.log(e)}else e=JSON.parse(this.responseText),console.log(e)},t.open("PUT",videoApi+"/"+e,!0),t.setRequestHeader("Content-Type","application/json"),t.setRequestHeader("Authorization",localStorage.getItem("token")),t.send(JSON.stringify(this))},""===location.search)$("#alertModal").modal();else{var searchObj=convertLocationSearchToJSON(location.search);void 0===searchObj||void 0===searchObj.plid&&void 0===searchObj.yid?$("#alertModal").modal():void 0!==searchObj.yid?(loadVideoOfYoutube(searchObj.yid),null!==userToken&&(document.querySelector("#y-video-activator").style.display="",loadPlaylistDetail(""))):void 0!==searchObj.plid&&(null!==userToken?(loadPlaylistDetail(searchObj.plid),document.querySelector("#watching-playlist").style.display="",document.querySelector("#c-video-activator").style.display="",void 0!==searchObj.cid?loadVideoOfPlaylist(searchObj.plid,searchObj.cid):loadVideoOfPlaylist(searchObj.plid,"")):$("#alertModal").modal())}